# Quiz Create - 詳細手順

作問は **共通ステップ（1〜4）** → **形式別ステップ（5〜7）** の順で実行する。

---

## 共通ステップ（早押し・4択 共通）

### Step 1: 重要情報の抽出

テキストから、クイズの素材になりそうな重要な情報を取り出す。

**プロンプト:**
```
以下のテキストから重要な情報を取り出してください。
テキスト: {text}
```

**出力:** `importantInfo`（重要な情報のまとめ）

---

### Step 2: 答え候補の特定

重要情報の中から、クイズの「答え」として適切な単語を1つ選ぶ。

**条件:**
- 答えは単語で（文章ではない）
- 「○○円で△△の差額が□□」のような複数情報を含むものはNG
- 「○○円」「○○年」「○○の名称」のような単一情報がOK

**プロンプト:**
```
以下に、テキストとその重要な情報を渡します。早押しクイズの答えとしてふさわしい単語を選んでください。

テキスト: {text}
重要な情報: {importantInfo}
```

**出力:** `answerBase`（答えとなる単語）

---

### Step 3: 問題文素材の収集

答えに結びつく情報を2つ取り出す。問題文の序盤・終盤に使う素材になる。

**プロンプト:**
```
テキスト: {text}
重要な情報: {importantInfo}
答え: {answerBase}

このテキストから、「{answerBase}」という答えに結びつく重要な情報を2つ抜き出してください。
```

**出力:** `quizInfo`（問題文素材2つ）

---

### Step 4: スタイル決定

問題文のスタイルを決定する。通常は1文スタイル。低確率（1/100）で2文スタイル（体言止め）になる。

- **通常（99/100）:** 「今回の問題文は1文で構成し、体言止めを使わないこと。」
- **2文スタイル（1/100）:** 「今回の問題文は2文で構成すること。」

**出力:** `questionStylePolicy`

---

## 早押しクイズ（Step 5〜7）

### Step 5: 問題文と答えの作成

**プロンプト:**
```
テキスト: {text}
重要な情報: {importantInfo}
クイズの答え: {answerBase}
クイズの問題文作成に有用な情報: {quizInfo}
スタイル方針: {questionStylePolicy}

このテキストから、早押しクイズを1問作成してください。
作問方針は policies.md の「作問方針」に従うこと。
必ず次のJSON形式で出力してください: {"quiz":"...", "answer":"..."}
JSON以外の出力はしないでください。
```

**出力:** `quiz`（問題文）、`answer`（答え）

---

### Step 6: 品質審査

**プロンプト:**
```
テキスト: {text}
クイズの問題文: {quiz}
答え: {answer}

テキストから生み出されたクイズの問題文と答えの組み合わせが適切であるか審査してください。
審査基準は policies.md の「審査方針」に従うこと。
適切でない場合、修正を提案してください。
```

**出力:** `evaluation`（審査結果・修正提案）

---

### Step 7: 修正

**プロンプト:**
```
テキスト: {text}
重要な情報: {importantInfo}
問題文: {quiz}
答え: {answer}
クイズが適切かの判断: {evaluation}

これらの情報をもとに、必要ならば問題文と答えを修正してください。
適切と判断されている場合は変える必要はありません。
必ず次のJSON形式で出力してください: {"quiz":"...", "answer":"..."}
JSON以外の出力はしないでください。
```

**最終出力:** `quiz`（問題文）、`answer`（答え）

---

## 4択クイズ（Step 5〜7）

### Step 5: 4択問題の作成

**出力形式:** `{"question":"...", "choices":["...","...","...","..."], "correctIndex":0-3, "explanation":"..."}`

**条件:**
- 選択肢は4個。全て意味が異なり、重複・同義語の言い換えは禁止
- 正答は一意。曖昧な解釈で複数が正しくならないこと
- ダミー選択肢は「ありそうだが誤り」にする

**プロンプト:**
```
テキスト: {text}
重要な情報: {importantInfo}
答え候補: {answerBase}
問題文に入れたい情報: {quizInfo}
スタイル方針: {questionStylePolicy}

4択クイズを1問作成してください。作問方針は policies.md の「作問方針」に従うこと。
必ずJSONのみを出力してください:
{"question":"...", "choices":["...","...","...","..."], "correctIndex":0-3, "explanation":"..."}
```

---

### Step 6: 品質審査

**確認観点:**
- 正答は一意か（他選択肢が正解になり得ないか）
- 重複・同義の選択肢がないか
- ダミーが不自然・成り立たない・過度に紛らわしいものではないか
- 出題文と選択肢の整合性

**プロンプト:**
```
テキスト: {text}
問題文: {question}
選択肢: {choices}
正答インデックス: {correctIndex}

上記の4択クイズの妥当性を短く評価し、必要なら修正方針を示してください。
```

**出力:** `evaluation`（評価・修正方針）

---

### Step 7: 修正

**プロンプト:**
```
テキスト: {text}
問題文(元): {question}
選択肢(元): {choices}
正答インデックス(元): {correctIndex}
解説(元): {explanation}
評価コメント: {evaluation}

必要な場合だけ問題文・選択肢・正答・解説を修正してください。必ずJSONのみを出力:
{"question":"...", "choices":["...","...","...","..."], "correctIndex":0-3, "explanation":"..."}
```

**最終出力:** `question`、`choices[4]`、`correctIndex`、`explanation`
